#!/bin/bash

echo "=================================================================="
printf "%-5s | %-10s | %-25s | %-20s\n" "GPU" "Slot Num" "GPU Name" "Bus-Id"
echo "------------------------------------------------------------------"

nvidia-smi --query-gpu=index,pci.bus_id,name --format=csv,noheader | while IFS=',' read -r index bus_id name; do
    index=$(echo $index | xargs)
    bus_id=$(echo $bus_id | xargs | tr '[:upper:]' '[:lower:]')
    name=$(echo $name | xargs)
    short_bus_id=$(echo $bus_id | sed 's/^00000000:/0000:/')
    slot="N/A (BIOS 확인)"
    
    # 여기서 2>/dev/null 부분을 제거했습니다.
    for addr_file in /sys/bus/pci/slots/*/address; do
        if [ -f "$addr_file" ]; then
            slot_addr=$(cat "$addr_file")
            if [[ "$short_bus_id" == *"$slot_addr"* ]]; then
                slot=$(basename $(dirname "$addr_file"))
                break
            fi
        fi
    done
    printf "%-5s | %-10s | %-25s | %-20s\n" "$index" "$slot" "$name" "$bus_id"
done
echo "=================================================================="
