#!/bin/bash

echo "=================================================================================================="
printf "%-12s | %-12s | %-10s | %s\n" "Interface" "Bus / Slot" "Link State" "Physical Chipset"
echo "=================================================================================================="

for iface_path in /sys/class/net/*; do
    iface=$(basename "$iface_path")
    
    # 가상 인터페이스 제외
    if [ "$iface" = "lo" ] || [ ! -e "$iface_path/device" ]; then
        continue
    fi

    # 버스/슬롯 주소 추출
    bus_id=$(basename $(readlink "$iface_path/device"))
    
    # 링크 상태
    link_state=$(cat "$iface_path/operstate" 2>/dev/null)
    [ -z "$link_state" ] && link_state="unknown"

    # 칩셋 정보 추출 (에러 메시지 숨김 처리)
    if command -v lspci >/dev/null 2>&1; then
        # 2>/dev/null 추가하여 Invalid bus number 에러가 화면에 뜨지 않게 차단
        chipset=$(lspci -s "$bus_id" 2>/dev/null | cut -d' ' -f2- | sed 's/^[A-Za-z ]*: //')
        
        # lspci 결과가 비어있다면(USB 장치 등) 대체 텍스트 삽입
        [ -z "$chipset" ] && chipset="USB or Non-PCI Device"
    else
        chipset="lspci command not found."
    fi

    # 버스 ID와 슬롯 번호를 포함하여 한 행에 깔끔하게 매칭
    printf "%-12s | %-12s | %-10s | %s\n" "$iface" "$bus_id" "$link_state" "$chipset"
done

echo "=================================================================================================="
